<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
<meta charset="UTF-8" />
<title>Adventures in OpenCL: Part 1.5, C++ Bindings | enj</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://d3a9pqeyre6pa0.cloudfront.net/wp-content/themes/twentyten-child/style.css" />
<link rel="pingback" href="../../../../../xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="enj &raquo; Feed" href="../../../../../enjaorg" />
<link rel="alternate" type="application/rss+xml" title="enj &raquo; Comments Feed" href="../../../../../comments/feed/index.html" />
				
	<script type="text/javascript">//<![CDATA[
	// Google Analytics for WordPress by Yoast v4.2.3 | http://yoast.com/wordpress/google-analytics/
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount','UA-16564388-1']);
	_gaq.push(['_trackPageview']);
	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
	//]]></script>
<link rel="alternate" type="application/rss+xml" title="enj &raquo; Adventures in OpenCL: Part 1.5, C++ Bindings Comments Feed" href="../feed/index.html" />
<link rel='stylesheet' id='tfg_style-css'  href='../../../../../wp-content/plugins/twitter-facebook-google-plusone-share/tfg_style.css%3Fver=3.3.2.css' type='text/css' media='all' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://enja.org/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Adventures in OpenCL: Part 1, Getting Started' href='../../../13/adventures-in-opencl-part-1-getting-started/index.html' />
<link rel='next' title='Particles in BGE Update: GLSL, more options' href='../../../22/particles-in-bge-update-glsl-more-options/index.html' />
<meta name="generator" content="WordPress 3.3.2" />
<link rel='shortlink' href='http://wp.me/pgWjI-40' />

<!-- All in One SEO Pack 1.6.14.2 by Michael Torbert of Semper Fi Web Design[82,139] -->
<meta name="description" content="This tutorial series is aimed at developers trying to learn OpenCL from the bottom up, with a focus on practicality. This part is a reworking of my first" />
<meta name="keywords" content="advcl,code,opencl,tutorial" />
<link rel="canonical" href="../index.html" />
<!-- /all in one seo pack -->
<meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.3" />
</head>

<body class="single single-post postid-248 single-format-standard">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">
			<div id="branding" role="banner">
								<div id="site-title">
					<span>
						<a href="../../../../../index.html" title="enj" rel="home">enj</a>
					</span>
				</div>
				<div id="site-description">casin&#039; the joint since &#039;85</div>

										<img src="http://d3a9pqeyre6pa0.cloudfront.net/wp-content/uploads/2010/07/cropped-turtle_nom1.jpg" width="940" height="198" alt="" />
								</div><!-- #branding -->

			<div id="access" role="navigation">
			  				<div class="skip-link screen-reader-text"><a href="index.html#content" title="Skip to content">Skip to content</a></div>
								<div class="menu-header"><ul id="menu-navigation" class="menu"><li id="menu-item-319" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-319"><a href="../../../../../index.html" >Home</a></li>
<li id="menu-item-318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-318"><a href="../../../../../about/index.html" >About</a></li>
<li id="menu-item-694" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-694"><a href="../../../../../d3/index.html" >d3</a></li>
<li id="menu-item-316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-316"><a href="../../../../../blender/index.html" >Blender</a></li>
<li id="menu-item-315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-315"><a href="../../../../../opencl/index.html" >OpenCL</a></li>
<li id="menu-item-317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-317"><a href="../../../../../side-projects/index.html" >Side Projects</a></li>
</ul></div>			</div><!-- #access -->
		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="../../../13/adventures-in-opencl-part-1-getting-started/index.html" rel="prev"><span class="meta-nav">&larr;</span> Adventures in OpenCL: Part 1, Getting Started</a></div>
					<div class="nav-next"><a href="../../../22/particles-in-bge-update-glsl-more-options/index.html" rel="next">Particles in BGE Update: GLSL, more options <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-above -->

				<div id="post-248" class="post-248 post type-post status-publish format-standard hentry category-advcl category-code category-opencl category-tutorial">
					<h1 class="entry-title">Adventures in OpenCL: Part 1.5, C++ Bindings</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted on</span> <a href="../index.html" title="12:02 am" rel="bookmark"><span class="entry-date">July 20, 2010</span></a> <span class="meta-sep">by</span> <span class="author vcard"><a class="url fn n" href="../../../../../author/admin/index.html" title="View all posts by enj">enj</a></span>					</div><!-- .entry-meta -->

					<div class="entry-content">
						<p>This tutorial series is aimed at developers trying to learn <a href="http://www.khronos.org/opencl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">OpenCL</a> from the bottom up, with a focus on practicality. This part is a reworking of my <a href="../../../13/adventures-in-opencl-part-1-getting-started/index.html" >first tutorial</a> using the OpenCL C++ Bindings. Learning by example works best for me so make sure toÂ <a href="http://github.com/enjalot/adventures_in_opencl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">get the code</a>! It can only help you to have a copy of the <a href="http://www.khronos.org/registry/cl/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">OpenCL specification handy</a>, and it doesn&#8217;t hurt (too bad) to read it!</p>
<p>My code works for me on my Macbook Pro (with Geforce 9400M) running Snow Leopard with the <a href="http://developer.nvidia.com/object/cuda_3_1_downloads.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://developer.nvidia.com']);">NVIDIA GPU SDK</a> as well as on the Ubuntu 10.4 workstations (with GTX 480 or Geforce 8800GTX). Unfortunately I haven&#8217;t spent any time developing on Windows so for now my tutorials will be UNIX centric (I would LOVE any help in setting up a windows environment, I&#8217;ll need to eventually for my <a href="../../../../05/20/blender-and-opencl-the-journey-begins/index.html" >Blender project</a>). Also the code should build against the ATI Stream SDK and run on the runtime, you can assume I&#8217;m complying with OpenCL 1.0 (1.1 may be covered in the more advanced topics, and I&#8217;ll point it out). Please let me know if you have build problems or device issues! Throughout the tutorial I will refer to device and GPU interchangeably, OpenCL can run on CPUs already and is targeting many other devices, but for now I&#8217;m assuming a <a href="http://gpgpu.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://gpgpu.org']);">GPGPU</a> bias.</p>
<h2>Let&#8217;s get started!</h2>
<p>You&#8217;ll need to have installed:</p>
<p><a href="http://developer.nvidia.com/object/cuda_3_1_downloads.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://developer.nvidia.com']);">NVIDIA</a> or <a href="http://developer.amd.com/gpu/atistreamsdk/pages/default.aspx" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://developer.amd.com']);">ATI</a> GPU SDK and OpenCL enabled drivers<br />
(Ubuntu ATI users might like <a href="http://mathnathan.com/2010/08/30/opencl/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://mathnathan.com']);">extra guidance</a>)<br />
<a href="http://www.cmake.org/cmake/resources/software.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.cmake.org']);"> CMake</a> (<a href="http://mathnathan.com/2010/07/11/getting-started-with-cmake/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://mathnathan.com']);">introduction</a> and <a href="http://www.elpauer.org/stuff/learning_cmake.pdf" onclick="javascript:_gaq.push(['_trackEvent','download','http://www.elpauer.org/stuff/learning_cmake.pdf']);">in-depth tutorial [pdf]</a>)<br />
and it helps to have <a href="http://git-scm.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://git-scm.com']);">Git</a> (<a href="http://mathnathan.com/2010/07/09/git/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://mathnathan.com']);">introduction</a> and <a href="http://progit.org/book/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://progit.org']);">nice book</a>)</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">Download the code</a> and for the rest of the tutorial I will refer to the directory it&#8217;s in as <span class="simple_code">advcl</span></p>
<p>In the advcl directory you should have the following directories:</p>
<pre>part1.5/     //the source code files for this tutorial
cmake/       //CMake scripts that help locate necessary libraries
opencl10/    //OpenCL 1.0 header files (downloaded from <a href="http://www.khronos.org/registry/cl/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">Khronos.org</a>)
opencl11/    //OpenCL 1.1 header files (downloaded from <a href="http://www.khronos.org/registry/cl/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">Khronos.org</a>)
</pre>
<p>First we will build the code to make sure it works, I like to do an &#8220;out of source&#8221; build like so:</p>
<pre class="brush: bash; title: ; notranslate" title="">cd part1.5
mkdir build
cd build
cmake ..
make
</pre>
<p>This will generate all of the build files, the Makefile, the library and executable in the build directory which avoids cluttering up your source code directory. You can run the example like so:</p>
<pre class="brush: bash; title: ; notranslate" title="">./part1.x</pre>
<h2>The Source Code Files </h2>
<p>Let&#8217;s first have a broad overview of each of the source files and then we can dive in and look at what the code is doing. I&#8217;ve the code up to be a library with a CL class that can be instantiated and utilized anywhere. For this tutorial it is not very generalized so that it&#8217;s easier to see what&#8217;s going on behind the scenes. In future tutorials we will refactor and make our library more powerful!</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/main.cpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">main.cpp</a><br />
This is where we test out our CL class. We instantiate it, give it an opencl program to compile and run, then execute the kernel.</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/cll.h" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">cll.h</a><br />
The main header file for our CL class definition, also handles including the OpenCL libraries. I&#8217;ve downloaded the header files from the <a href="http://khronos.org/registry/cl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://khronos.org']);">Khronos website</a> to avoid having to search the computer for a particular SDK.</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/cll.cpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">cll.cpp</a><br />
The core implementation of our CL class, including functions for initializing the OpenCL context, loading and building an OpenCL program.</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/part1.cpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">part1.cpp</a><br />
Implementation of the functions that setup and run the OpenCL kernel. This is where we actually see OpenCL in action. </p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/part1.cl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">part1.cl</a><br />
The actual OpenCL code to be executed. Right now it&#8217;s a simple kernel that adds two arrays and stores the result in a third.</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/util.h" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">util.h</a> and <a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/util.cpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">util.cpp</a><br />
Utility functions that make things like reading files or printing out OpenCL error messages easier</p>
<p><a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/CMakeLists.txt" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">CMakeLists.txt</a><br />
The configuration and build script used to build the project. This makes it easier to be portable, and building our code as a library makes it easier to contribute to other projects.</p>
<h2>The Source Code Contents</h2>
<p>Let&#8217;s follow the execution of the main function to see what order things need to be done in. Of course we need to include our library&#8217;s definitions:</p>
<pre class="brush: cpp; title: ; notranslate" title="">#include &quot;cll.h&quot;</pre>
<p>This includes the OpenCL headers as well as defines our CL class. If you look there you will see a few public member objects of type <span class="simple_code">cl::Buffer</span> which will point to arrays on our device. The private <span class="simple_code">cl::*</span> member objects are key OpenCL objects which we will use in the constructor to setup OpenCL for execution.<br />
The constructor is defined in cll.cpp where it does a few things: sets the platform, sets the device to use, creates the OpenCL context and a command queue. Let&#8217;s see how its done:</p>
<pre class="brush: cpp; title: ; notranslate" title="">    std::vector&lt;cl::Platform&gt; platforms;
    cl::Platform::get(&amp;platforms);
    printf(&quot;cl::Platform::get(): %s\n&quot;, oclErrorString(err));</pre>
<p>This is the first example of the nice cl wrapper class specified in the C++ bindings where we get the device Platforms. As you can see it is much cleaner than <a href="../../../13/adventures-in-opencl-part-1-getting-started/index.html" >the previous code</a>. The 3rd line is something you will see peppered throughout the code, <span class="simple_code">oclErrorString(err)</span> is a useful helper function I lifted from the NVIDIA SDK that gives you a little more info about what went wrong if you have a problem. You can get some more explanation of the different error types if you go to the khronos specification for the function that errored, for example <a href="http://www.khronos.org/registry/cl/sdk/1.0/docs/man/xhtml/clGetDeviceIDs.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">clGetDeviceIDs</a> (a quick google search for the function name generally returns the khronos page first).</p>
<p>After we set the platform (for now we just select the first platform in the list), we use it to create a context. For this tutorial we choose the GPU to be the device. This could of course become more sophisticated with multiple graphics cards or other devices, and in another tutorial we will discuss checking for device capabilities.</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    cl_context_properties properties[] =
        { CL_CONTEXT_PLATFORM, (cl_context_properties)(platforms[0])(), 0};
    context = cl::Context(CL_DEVICE_TYPE_GPU, properties);
    devices = context.getInfo&lt;CL_CONTEXT_DEVICES&gt;();
</pre>
<p>and the last action of the constructor is to create the command queue</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    deviceUsed = 0;
    try{
        queue = cl::CommandQueue(context, devices[deviceUsed], 0, &amp;err);
    }
    catch (cl::Error er) {
        printf(&quot;ERROR: %s(%d)\n&quot;, er.what(), er.err());
    }
</pre>
<p>Here you see some use of exceptions provided by <a href="http://www.khronos.org/registry/cl/api/1.1/cl.hpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.khronos.org']);">cl.hpp</a>, note it is necessary to set</p>
<pre class="brush: cpp; title: ; notranslate" title="">#define __CL_ENABLE_EXCEPTIONS</pre>
<p> as I did at the top of cll.h.</p>
<p>Once the constructor is finished, we want to load our OpenCL program, so in main.cpp we do:</p>
<pre class="brush: cpp; title: ; notranslate" title="">
#include &quot;part1.cl&quot;
example.loadProgram(&quot;part1.cl&quot;);</pre>
<p>You may wonder why we have an include here, I find it a nice way to bundle our OpenCL source with our library using a neat little <a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1.5/part1.cl" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">macro trick</a>.<br />
<span class="simple_code">loadProgram</span> is defined in cll.cpp:</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    int pl;
    cl::Program::Sources source(1,
        std::make_pair(kernel_source,pl));
    program = cl::Program(context, source);</pre>
<p>Once the program is created, it must also be compiled. It also helps to have some compiler output incase we have syntax errors (never!).</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    err = program.build(devices);
    printf(&quot;program.build: %s\n&quot;, oclErrorString(err));
    if(err != CL_SUCCESS){
        std::cout &lt;&lt; &quot;Build Status: &quot; &lt;&lt; program.getBuildInfo&lt;CL_PROGRAM_BUILD_STATUS&gt;(devices[0]) &lt;&lt; std::endl;
        std::cout &lt;&lt; &quot;Build Options:\t&quot; &lt;&lt; program.getBuildInfo&lt;CL_PROGRAM_BUILD_OPTIONS&gt;(devices[0]) &lt;&lt; std::endl;
        std::cout &lt;&lt; &quot;Build Log:\t &quot; &lt;&lt; program.getBuildInfo&lt;CL_PROGRAM_BUILD_LOG&gt;(devices[0]) &lt;&lt; std::endl;
    }
</pre>
<p>Once the program is loaded and built we are ready to pass the data to our device and do some computing! Let&#8217;s take a quick look at our simple kernel in part1.cl so we have an idea of what we are trying to do:</p>
<pre class="brush: cpp; title: ; notranslate" title="">__kernel void part1(__global float* a, __global float* b, __global float* c)
{
    unsigned int i = get_global_id(0);
    c[i] = a[i] + b[i];
}</pre>
<p>Since I&#8217;m still forming my understanding of OpenCL I&#8217;ll avoid explaining the details (you and me both gotta read the spec! or check out some of NVIDIA&#8217;s nice webinars). This serves as a practical starting point for you to write your own kernels, so lets see what I&#8217;m doing here.<br />
I define my kernel as <span class="simple_code">part1</span> and it takes in three paramaters. The <span class="simple_code">__global</span> keyword says what kind of device memory our input is stored in, and besides that we should already be familiar with passing arrays to functions as a pointer.</p>
<p>One way to think of the kernel is as a replacement for a for loop (you can do much cooler things, but we gotta start somewhere). We get the index in the for loop from the get_global_id built in function, and then we do our operation on the arrays at that index. We let OpenCL split up the arrays into work-units  and it will try to do as many of them as possible in parallel.</p>
<p>So how do we give OpenCL our arrays and tell it to do the work? That&#8217;s all in <a href="http://github.com/enjalot/adventures_in_opencl/blob/master/part1/part1.cpp" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">part1.cpp</a><br />
We setup our kernel with the <span class="simple_code">popCorn</span> function (hehe)<br />
First we go ahead and call it (with error checking)</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    try{
        kernel = cl::Kernel(program, &quot;part1&quot;, &amp;err);
    }
    catch (cl::Error er) {
        printf(&quot;ERROR: %s(%d)\n&quot;, er.what(), er.err());
    }
</pre>
<p>Notice that the string we pass in is the name of the kernel as we defined it in the .cl file.<br />
Then we setup the arrays we want to work on, I created a trivial example as you can see in the file. The important part is creating the OpenCL array buffers and pushing the data to the device:</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    size_t array_size = sizeof(float) * num;
    //our input arrays
    cl_a = cl::Buffer(context, CL_MEM_READ_ONLY, array_size, NULL, &amp;err);
    cl_b = cl::Buffer(context, CL_MEM_READ_ONLY, array_size, NULL, &amp;err);
    //our output arrayw
    cl_c = cl::Buffer(context, CL_MEM_WRITE_ONLY, array_size, NULL, &amp;err);
</pre>
<p>Note that our input are defined as read buffers, and our output is a write, there is also CL_MEM_READ_WRITE, and these are suggestions to the device on how you will use the buffers so it can optimize for performance.<br />
Pushing the data is the same for each one:</p>
<pre class="brush: cpp; title: ; notranslate" title="">err = queue.enqueueWriteBuffer(cl_a, CL_TRUE, 0, array_size, a, NULL, &amp;event);</pre>
<p>Then we tell the kernel which buffers correspond to which arguments</p>
<pre class="brush: cpp; title: ; notranslate" title="">
    err = kernel.setArg(0, cl_a);
    err = kernel.setArg(1, cl_b);
    err = kernel.setArg(2, cl_c);
</pre>
<p>You can also pass in other types of arguments, but we should see that in the next installment.<br />
We introduce</p>
<pre class="brush: cpp; title: ; notranslate" title="">queue.finish();</pre>
<p>Which makes sure that all commands in the queue are done executing before the program continues. This will be more important in later tutorials where we run our kernel in a loop as fast as possible.<br />
For now we just run it once in the <span class="simple_code">runKernel()</span> function:</p>
<pre class="brush: cpp; title: ; notranslate" title="">err = queue.enqueueNDRangeKernel(kernel, cl::NullRange, cl::NDRange(num), cl::NullRange, NULL, &amp;event);</pre>
<p>The <span class="simple_code">cl::NDRange(num)</span> is the global workgroup size, and is one-dimensional like our arrays.<br />
Finally, we read from our device memory to see if the c array got updated the way we expected!</p>
<pre class="brush: cpp; title: ; notranslate" title="">float *c_done;
err = queue.enqueueReadBuffer(cl_c, CL_TRUE, 0, sizeof(float) * num, c_done, NULL, &amp;event);</pre>
<p>now we can simply print out the contents of the c_done array!</p>
<pre class="brush: cpp; title: ; notranslate" title="">for(int i=0; i &lt; num; i++)
{
    printf(&quot;c_done[%d] = %g\n&quot;, i, c_done[i]);
}</pre>
<p>Hopefully the code and this walk-through give you a good starting point to learn more. Expect more tutorials, with the next one involving the OpenCL Profiler and determining device information, followed by OpenCL/OpenGL context sharing.<br />
I definitely appreciate any feedback!</p>
<div class="bottomcontainerBox" style="background-color:#FFFFFF;">
			<div style="float:left; width:85px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fenja.org%2F2010%2F07%2F20%2Fadventures-in-opencl-part-1-5-cpp-bindings%2F&amp;layout=button_count&amp;show_faces=false&amp;width=85&amp;action=like&amp;font=verdana&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" allowTransparency="true" style="border:none; overflow:hidden; width:85px; height:21px;"></iframe></div>
			<div style="float:left; width:80px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<g:plusone size="medium" href="http://enja.org/2010/07/20/adventures-in-opencl-part-1-5-cpp-bindings/"></g:plusone>
			</div>
			<div style="float:left; width:95px;padding-right:10px; margin:4px 4px 4px 4px;height:30px;">
			<a href="http://twitter.com/share" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://twitter.com']);" class="twitter-share-button" data-url="http://enja.org/2010/07/20/adventures-in-opencl-part-1-5-cpp-bindings/"  data-text="Adventures in OpenCL: Part 1.5, C++ Bindings" data-count="horizontal" data-via="enjalot"></a>
			</div>			
			</div><div style="clear:both"></div><div style="padding-bottom:4px;"></div>											</div><!-- .entry-content -->


					<div class="entry-utility">
						This entry was posted in <a href="../../../../../category/tutorial/advcl/index.html" title="View all posts in advcl" rel="category tag">advcl</a>, <a href="../../../../../category/code/index.html" title="View all posts in code" rel="category tag">code</a>, <a href="../../../../../category/opencl/index.html" title="View all posts in opencl" rel="category tag">opencl</a>, <a href="../../../../../category/tutorial/index.html" title="View all posts in tutorial" rel="category tag">tutorial</a>. Bookmark the <a href="../index.html" title="Permalink to Adventures in OpenCL: Part 1.5, C++ Bindings" rel="bookmark">permalink</a>.											</div><!-- .entry-utility -->
				</div><!-- #post-## -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="../../../13/adventures-in-opencl-part-1-getting-started/index.html" rel="prev"><span class="meta-nav">&larr;</span> Adventures in OpenCL: Part 1, Getting Started</a></div>
					<div class="nav-next"><a href="../../../22/particles-in-bge-update-glsl-more-options/index.html" rel="next">Particles in BGE Update: GLSL, more options <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
			<div id="comments">


			<h3 id="comments-title">11 Responses to <em>Adventures in OpenCL: Part 1.5, C++ Bindings</em></h3>


			<ol class="commentlist">
					<li class="comment even thread-even depth-1" id="li-comment-200">
		<div id="comment-200">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/85e1094db53ad701bbc2291bdb09d144?s=40&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">Peter E</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-200">
			July 29, 2010 at 9:00 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Hey thanks for the tutorial . . .<br />
It seems like you&#8217;re missing some memory management in part1.cpp.   In runKernel(), you need to allocate memory for the result array:<br />
<code><br />
float *c_done = new float[num];<br />
</code><br />
Without that you will probably get an access violation (I do with Visual Studio on windows).<br />
You should also probably delete that array and the others in popCorn():<br />
<code><br />
delete [] a;<br />
delete [] b;<br />
delete [] c;<br />
</code></p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="post pingback">
		<p>Pingback: <a href="../../../../08/27/adventures-in-opencl-part-2-particles-with-opengl/index.html"   rel='external nofollow' class='url'>Adventures in OpenCL Part 2: Particles with OpenGL | enj</a></p>
	</li>
	<li class="post pingback">
		<p>Pingback: <a href="../../../13/adventures-in-opencl-part-1-getting-started/index.html"   rel='external nofollow' class='url'>Adventures in OpenCL: Part 1, Getting Started | enj</a></p>
	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-273">
		<div id="comment-273">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/a2f31aa80a0e5fdf02de29d2e048aad4?s=40&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn"><a href="http://iklsr.blogspot.com" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://iklsr.blogspot.com']);"  rel='external nofollow' class='url'>iKlsR</a></cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-273">
			September 4, 2010 at 12:56 pm</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>arrrgh why cant i escape arrays :)<br />
doing this now on open CL compiled in C# :)</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment even thread-even depth-1" id="li-comment-591">
		<div id="comment-591">
		<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/50a9fc7a2606118a0b3b09193d6948b0?s=40&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">karimkhan</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-591">
			January 13, 2011 at 1:42 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Hi dear , Thanks for your code and guidance , I tried to compile and run main.cpp , part2.cpp but it&#8217;s giving lots of errors . Was the code complete or need corrections ?</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-705">
		<div id="comment-705">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/00a81cc8c15078031eda0e54f154fa9b?s=40&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">Zozor</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-705">
			March 14, 2011 at 11:24 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>It almost work out of the box on Ubuntu Maverick Meerkat with CUDA drivers enabled. The only modification I had to do was to replace<br />
<code><br />
exit(0);<br />
</code><br />
in your main.cpp by a<br />
<code><br />
return 0;<br />
</code><br />
:)</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="post pingback">
		<p>Pingback: <a href="../../../../../2011/03/30/adventures-in-opencl-part-3-constant-memory-structs/index.html"   rel='external nofollow' class='url'>Adventures in OpenCL Part 3: Constant Memory Structs | enj</a></p>
	</li>
	<li class="comment even thread-even depth-1" id="li-comment-863">
		<div id="comment-863">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/055c379846cfe6e24f317c43e2d8fcb2?s=40&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn"><a href="http://deep-beta.co.uk" onclick="javascript:_gaq.push(['_trackEvent','outbound-commentauthor','http://deep-beta.co.uk']);"  rel='external nofollow' class='url'>Lukasz Iwanski</a></cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-863">
			May 17, 2011 at 5:58 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Hey,<br />
Really nice tutorial. Well done! :)<br />
I am doing research for technology that I should use in voxel based terrain renderer and OpenCL seems like way to go.</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-1486">
		<div id="comment-1486">
		<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/5f98c847ca74b72d09effbd62fa9a115?s=40&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">Mark Lo Chiano</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-1486">
			November 26, 2011 at 4:07 pm</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>The probable answer to this is a flat out &#8211; NO, but is it possible to create new memory elements on the GPU and pass them back to the host?   I am thinking about a situration where new vertexes might need to be created (e.g. tesselation of 3D objects).</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment even thread-even depth-1" id="li-comment-1549">
		<div id="comment-1549">
		<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/d5a05c2675e17511a0462425a80a4deb?s=40&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">KB</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-1549">
			December 15, 2011 at 5:39 pm</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Thanks for your tutorial, I&#8217;m about to use OpenCL in C++ for my Bachelor&#8217;s thesis and I&#8217;m glad I found your site :)</p>
<p>I think I understood everything, but one question remains: Why do you split the implementation of the functions in cll.h across the two files cll.cpp and part1.cpp ?</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-1595">
		<div id="comment-1595">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/a882c91f8f1c5cc587617a021c8916ac?s=40&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />			<cite class="fn">Jelmer Wolterink</cite> <span class="says">says:</span>		</div><!-- .comment-author .vcard -->
		
		<div class="comment-meta commentmetadata"><a href="index.html#comment-1595">
			January 6, 2012 at 10:24 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body"><p>Thanks for your tutorial. I was looking for a quick start in OpenCL and this really helped me forward.</p>
</div>

		<div class="reply">
					</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li>
			</ol>



								
</div><!-- #comments -->


			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
			<ul class="xoxo">

<li id="search-3" class="widget-container widget_search"><form role="search" method="get" id="searchform" action="../../../../../index.html" >
	<div><label class="screen-reader-text" for="s">Search for:</label>
	<input type="text" value="" name="s" id="s" />
	<input type="submit" id="searchsubmit" value="Search" />
	</div>
	</form></li><li id="nav_menu-3" class="widget-container widget_nav_menu"><div class="menu-navigation-container"><ul id="menu-navigation-1" class="menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-319"><a href="../../../../../index.html" >Home</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-318"><a href="../../../../../about/index.html" >About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-694"><a href="../../../../../d3/index.html" >d3</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-316"><a href="../../../../../blender/index.html" >Blender</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-315"><a href="../../../../../opencl/index.html" >OpenCL</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-317"><a href="../../../../../side-projects/index.html" >Side Projects</a></li>
</ul></div></li><li id="text-4" class="widget-container widget_text">			<div class="textwidget"><a href="https://twitter.com/#!/enjalot" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="https://s2.googleusercontent.com/s2/favicons?alt=p&domain=twitter.com"> @enjalot</a>
<br/>
<a href="https://plus.google.com/112153365286725889851/posts" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://plus.google.com']);"><img src="https://s2.googleusercontent.com/s2/favicons?alt=p&domain=plus.google.com"> +Ian Johnson</a></div>
		</li><li id="categories-414549122" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-25"><a href="../../../../../category/tutorial/advcl/index.html" title="Adventures in OpenCL">advcl</a>
</li>
	<li class="cat-item cat-item-32"><a href="../../../../../category/tutorial/advd3-tutorial/index.html" title="View all posts filed under advd3">advd3</a>
</li>
	<li class="cat-item cat-item-23"><a href="../../../../../category/android/index.html" title="View all posts filed under android">android</a>
</li>
	<li class="cat-item cat-item-20"><a href="../../../../../category/blender/index.html" title="View all posts filed under blender">blender</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../../../../category/code/index.html" title="View all posts filed under code">code</a>
</li>
	<li class="cat-item cat-item-4"><a href="../../../../../category/community/index.html" title="View all posts filed under community">community</a>
</li>
	<li class="cat-item cat-item-5"><a href="../../../../../category/culture/index.html" title="View all posts filed under culture">culture</a>
</li>
	<li class="cat-item cat-item-33"><a href="../../../../../category/d3/index.html" title="View all posts filed under d3">d3</a>
</li>
	<li class="cat-item cat-item-6"><a href="../../../../../category/life/index.html" title="View all posts filed under life">life</a>
</li>
	<li class="cat-item cat-item-28"><a href="../../../../../category/math/index.html" title="View all posts filed under math">math</a>
</li>
	<li class="cat-item cat-item-7"><a href="../../../../../category/misc/index.html" title="View all posts filed under misc">misc</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../../../../category/music/index.html" title="View all posts filed under music">music</a>
</li>
	<li class="cat-item cat-item-9"><a href="../../../../../category/news/index.html" title="View all posts filed under news">news</a>
</li>
	<li class="cat-item cat-item-21"><a href="../../../../../category/opencl/index.html" title="View all posts filed under opencl">opencl</a>
</li>
	<li class="cat-item cat-item-30"><a href="../../../../../category/processingjs/index.html" title="View all posts filed under processingjs">processingjs</a>
</li>
	<li class="cat-item cat-item-29"><a href="../../../../../category/python/index.html" title="View all posts filed under python">python</a>
</li>
	<li class="cat-item cat-item-10"><a href="../../../../../category/race/index.html" title="View all posts filed under race">race</a>
</li>
	<li class="cat-item cat-item-11"><a href="../../../../../category/school/index.html" title="View all posts filed under school">school</a>
</li>
	<li class="cat-item cat-item-12"><a href="../../../../../category/tech/index.html" title="View all posts filed under tech">tech</a>
</li>
	<li class="cat-item cat-item-13"><a href="../../../../../category/travel/index.html" title="View all posts filed under travel">travel</a>
</li>
	<li class="cat-item cat-item-24"><a href="../../../../../category/tutorial/index.html" title="View all posts filed under tutorial">tutorial</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../../../../category/uncategorized/index.html" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
	<li class="cat-item cat-item-14"><a href="../../../../../category/wtf/index.html" title="View all posts filed under wtf">wtf</a>
</li>
	<li class="cat-item cat-item-15"><a href="../../../../../category/ä¸­æ%2596%2587/index.html" title="View all posts filed under ä¸­æ">ä¸­æ</a>
</li>
		</ul>
</li>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="site-info">
				<a href="../../../../../index.html" title="enj" rel="home">
					enj				</a>
			</div><!-- #site-info -->

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">Proudly powered by WordPress.</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->

<script type='text/javascript' src='http://d3a9pqeyre6pa0.cloudfront.net/wp-includes/js/jquery/jquery.js?ver=1.7.1'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?aa&#038;ver=3.3.2'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=3.3.2'></script>
	<div style="display:none">
	<div class="grofile-hash-map-85e1094db53ad701bbc2291bdb09d144">
	</div>
	<div class="grofile-hash-map-a2f31aa80a0e5fdf02de29d2e048aad4">
	</div>
	<div class="grofile-hash-map-50a9fc7a2606118a0b3b09193d6948b0">
	</div>
	<div class="grofile-hash-map-00a81cc8c15078031eda0e54f154fa9b">
	</div>
	<div class="grofile-hash-map-055c379846cfe6e24f317c43e2d8fcb2">
	</div>
	<div class="grofile-hash-map-5f98c847ca74b72d09effbd62fa9a115">
	</div>
	<div class="grofile-hash-map-d5a05c2675e17511a0462425a80a4deb">
	</div>
	<div class="grofile-hash-map-a882c91f8f1c5cc587617a021c8916ac">
	</div>
	</div>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js%3Fver=3.0.83c'></script>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushBash.js%3Fver=3.0.83c'></script>
<script type='text/javascript' src='../../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCpp.js%3Fver=3.0.83c'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://enja.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://enja.org/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = true;
	SyntaxHighlighter.all();
</script>
<script type='text/javascript' src='http://platform.twitter.com/widgets.js?ver=3.3.2'></script>
<script type='text/javascript' src='http://apis.google.com/js/plusone.js?ver=3.3.2'></script>

	<script src="http://stats.wordpress.com/e-201219.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:1.3',blog:'4037422',post:'248'});
	var load_cmc = function(){linktracker_init(4037422,248,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script></body>
</html>

<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Minified using disk: basic
Page Caching using disk: basic
Database Caching using disk: basic
Object Caching 1412/1527 objects using disk: basic
Content Delivery Network via Amazon Web Services: CloudFront: d3a9pqeyre6pa0.cloudfront.net

Served from: enja.org @ 2012-05-13 17:55:43 -->